# Data directory for chunked data (contains run_000***)
data_dir: '/mnt/msata/data/ASRL/field'

robot_type: 'm600'

save_graph: true

control_frame: 'base_link'
sensor_frame: 'zed_camera'
imu_frame: 'imu0_link'

navigator/nonstatic_sensor_frame: true
navigator/subscriber_buffer_len: 10

control_logger: false
control_override_logger_mission: false

# Tactic configuration
tactic/type: parallel # 'basic' or 'parallel'
tactic/num_threads: 1 # only applies to the parallel tactic
tactic/keyframe_parallelization: true
tactic/localization_parallelization: true
tactic/extrapolate_VO: true 
tactic/extrapolate_timeout: 2.0
tactic/extrapolate_offset: 0.2
tactic/use_existing_graph: false
tactic/keyframe_skippable: true
tactic/localization_skippable: true
locchain/angle_weight: 1.0 # for multirotor flight positional weight is more significant because gimbal handles orientation
locchain/min_cusp_distance: 150.0

# Misc configuration
scale: 1.0
throttle: false


############ Converter settings ############

# conversion module
#converter/conversion/conversions: ["RGB_TO_GRAYSCALE","RGB_TO_COLOR_CONSTANT"]
#converter/conversion/conversions: ["RGB_TO_GRAYSCALE"]
converter/conversion/conversions: []
converter/conversion/color_constant/weights: [0.5067]

# Extraction module
converter/extraction/extractor/type: ASRL_GPU_SURF
converter/extraction/type: conversion_extraction
#converter/extraction/extractor/channels: ["grayscale","cc_0.506700"]
converter/extraction/extractor/channels: ["mono8"]
converter/extraction/extractor/visualize_raw_features: false

# Conversion-Extraction module
#converter/extraction/conversions: ["RGB_TO_GRAYSCALE"]
converter/extraction/conversions: []
converter/extraction/color_constant/weights: [0.5067]

# SURF extraction module
converter/extraction/extractor/surf/upright_flag: false
converter/extraction/extractor/surf/threshold: .000001
converter/extraction/extractor/surf/nOctaves: 4
converter/extraction/extractor/surf/nIntervals: 4
converter/extraction/extractor/surf/initialScale: 1.5
converter/extraction/extractor/surf/edgeScale: 1.5
converter/extraction/extractor/surf/l1: 3.f/1.5f
converter/extraction/extractor/surf/l2: 5.f/1.5f
converter/extraction/extractor/surf/l3: 3.f/1.5f
converter/extraction/extractor/surf/l4: 1.f/1.5f
converter/extraction/extractor/surf/initialStep: 1
converter/extraction/extractor/surf/targetFeatures: 1000
converter/extraction/extractor/surf/detector_threads_x: 16
converter/extraction/extractor/surf/detector_threads_y: 16
converter/extraction/extractor/surf/regions_horizontal: 16
converter/extraction/extractor/surf/regions_vertical: 16
converter/extraction/extractor/surf/regions_target: 1000
converter/extraction/extractor/surf/stereoDisparityMinimum: 0.0
converter/extraction/extractor/surf/stereoDisparityMaximum: 64.0
converter/extraction/extractor/surf/stereoCorrelationThreshold: .2
converter/extraction/extractor/surf/stereoYTolerance: 0.9
converter/extraction/extractor/surf/stereoScaleTolerance: .9

# triangulation module
converter/triangulation/visualize_features: false
converter/triangulation/visualize_stereo_features: false
converter/triangulation/min_triangulation_depth: 7
converter/triangulation/max_triangulation_depth: 25

############ Quick VO settings ############

# integration module
quick_vo/integration/max_integration_time: 100.0 # seconds
quick_vo/integration/gravity: -9.80678
quick_vo/integration/debug: false
quick_vo/integration/gyro_bias_x: 0.003444
quick_vo/integration/gyro_bias_y: 0.000050
quick_vo/integration/gyro_bias_z: 0.003184
quick_vo/integration/acc_bias_x: 0.016493 #0.036493
quick_vo/integration/acc_bias_y: 0.031535
quick_vo/integration/acc_bias_z: 0.1995558
quick_vo/integration/invert_acc_z: false    # The M600's z axis is inverted

# matcher module
quick_vo/matcher/check_response: true
quick_vo/matcher/tight_matching_pixel_thresh: 30
quick_vo/matcher/matching_pixel_thresh: 400
quick_vo/matcher/tight_matching_x_sigma: 0.6
quick_vo/matcher/tight_matching_y_sigma: 0.6
quick_vo/matcher/tight_matching_phi_sigma: 0.6
quick_vo/matcher/tight_matching_theta_sigma: 0.6
quick_vo/matcher/tight_matching_psi_sigma: 0.6
quick_vo/matcher/max_point_depth: 200.0
quick_vo/matcher/parallel_threads: 4
quick_vo/matcher/prediction_method: none
quick_vo/matcher/use_pixel_variance: false
quick_vo/matcher/min_matches: 100
quick_vo/matcher/min_window_size: 5
quick_vo/matcher/max_window_size: 300
quick_vo/matcher/match_gpu_tight_knn_match_num: 5
quick_vo/matcher/match_gpu_loose_knn_match_num: 10
quick_vo/matcher/descriptor_thresh_cpu: 0.13
quick_vo/matcher/descriptor_thresh_gpu: 0.5
quick_vo/matcher/match_on_gpu: true
quick_vo/matcher/visualize_feature_matches: false

# RANSAC module
quick_vo/ransac/iterations: 500
quick_vo/ransac/sigma: 1.0
quick_vo/ransac/threshold: 2.0
quick_vo/ransac/early_stop_min_inliers: 400
quick_vo/ransac/min_inliers: 50
quick_vo/ransac/num_threads: 4
quick_vo/ransac/enable_local_opt: false
quick_vo/ransac/visualize_ransac_inliers: false

# Triangulation
quick_vo/triangulation/min_depth: 10
quick_vo/triangulation/max_depth: 500
quick_vo/triangulation/visualize_features: false
quick_vo/triangulation/max_reprojection_error: 10.0
quick_vo/triangulation/min_new_points: 0

# ROS Publishing module
quick_vo/quickvo_ros_publisher/use_position_as_lla: true
quick_vo/quickvo_ros_publisher/line_strip_scale: 0.015

# Keyframe optimisation
quick_vo/steam/verbose: false
quick_vo/steam/iterations: 1
quick_vo/steam/disable_solver: false   # Set true to do everything but run optimise()
quick_vo/steam/pose_prior_enable: false

quick_vo/steam/trajectory_smoothing: true
quick_vo/steam/lin_acc_std_dev_x: 3.0
quick_vo/steam/lin_acc_std_dev_y: 3.0
quick_vo/steam/lin_acc_std_dev_z: 3.0
quick_vo/steam/ang_acc_std_dev_x: 3.0
quick_vo/steam/ang_acc_std_dev_y: 3.0
quick_vo/steam/ang_acc_std_dev_z: 3.0

quick_vo/steam/velocity_prior: true
quick_vo/steam/lin_vel_mean_x: 0.0
quick_vo/steam/lin_vel_mean_y: 0.0
quick_vo/steam/lin_vel_mean_z: 0.0
quick_vo/steam/ang_vel_mean_x: 0.0
quick_vo/steam/ang_vel_mean_y: 0.0
quick_vo/steam/ang_vel_mean_z: 0.0
quick_vo/steam/lin_vel_std_dev_x: 3.0
quick_vo/steam/lin_vel_std_dev_y: 3.0
quick_vo/steam/lin_vel_std_dev_z: 3.0
quick_vo/steam/ang_vel_std_dev_x: 3.0
quick_vo/steam/ang_vel_std_dev_y: 3.0
quick_vo/steam/ang_vel_std_dev_z: 3.0

quick_vo/steam/use_T_q_m_prior: false
quick_vo/steam/depth_prior_enable: false
quick_vo/steam/depth_prior_weight: 1000000000
quick_vo/steam/max_point_depth: 200.0
quick_vo/steam/min_point_depth: 5.0
quick_vo/steam/perform_planarity_check: false
quick_vo/steam/plane_distance: 20.0
quick_vo/steam/absoluteCostChangeThreshold: 0.1

# Vertex test module
quick_vo/vertex_test/type: "gimbal_vertex_creation_test"
quick_vo/vertex_test/min_distance: 0.3
quick_vo/vertex_test/min_creation_distance: 1.5
quick_vo/vertex_test/max_creation_distance: 6.0
quick_vo/vertex_test/rotation_threshold_min: 8.0
quick_vo/vertex_test/rotation_threshold_max: 50.0
quick_vo/vertex_test/match_threshold_min_count: 150
quick_vo/vertex_test/match_threshold_fail_count: 100


############ Refined VO settings ############

# Steam module
refined_vo/steam/verbose: false
refined_vo/steam/iterations: 3
refined_vo/steam/pose_prior_enable: false

refined_vo/steam/trajectory_smoothing: true
refined_vo/steam/lin_acc_std_dev_x: 3.0
refined_vo/steam/lin_acc_std_dev_y: 3.0
refined_vo/steam/lin_acc_std_dev_z: 3.0
refined_vo/steam/ang_acc_std_dev_x: 3.0
refined_vo/steam/ang_acc_std_dev_y: 3.0
refined_vo/steam/ang_acc_std_dev_z: 3.0

refined_vo/steam/velocity_prior: true
refined_vo/steam/lin_vel_mean_x: 0.0
refined_vo/steam/lin_vel_mean_y: 0.0
refined_vo/steam/lin_vel_mean_z: 0.0
refined_vo/steam/ang_vel_mean_x: 0.0
refined_vo/steam/ang_vel_mean_y: 0.0
refined_vo/steam/ang_vel_mean_z: 0.0
refined_vo/steam/lin_vel_std_dev_x: 3.0
refined_vo/steam/lin_vel_std_dev_y: 3.0
refined_vo/steam/lin_vel_std_dev_z: 3.0
refined_vo/steam/ang_vel_std_dev_x: 3.0
refined_vo/steam/ang_vel_std_dev_y: 3.0
refined_vo/steam/ang_vel_std_dev_z: 3.0

refined_vo/steam/use_T_q_m_prior: false
#refined_vo/steam/solver_type: "LevenburgMarquardt"
refined_vo/steam/depth_prior_enable: false
refined_vo/steam/depth_prior_weight: 1000000000
refined_vo/steam/max_point_depth: 200.0
refined_vo/steam/min_point_depth: 1.0
refined_vo/steam/perform_planarity_check: false
refined_vo/steam/plane_distance: 20.0

# ROS Publishing module
refined_vo/refinedvo_ros_publisher/use_position_as_lla: true
refined_vo/refinedvo_ros_publisher/line_strip_scale: 0.015

############ Localization settings ############

# submap extraction module
loc/extraction/search_spatially: false
loc/extraction/temporal_max_depth: 8
loc/extraction/temporal_min_depth: 2
loc/extraction/sigma_scale: 5.0
loc/extraction/angle_weight: 5.0

# mel matcher module
loc/mel_matcher/target_match_count: 500
loc/mel_matcher/min_match_count: 50
loc/mel_matcher/tight_matching_pixel_thresh: 100.0
loc/mel_matcher/matching_pixel_thresh: 1000.0
loc/mel_matcher/min_response_ratio: 0.1
loc/mel_matcher/time_allowance: 120.0
loc/mel_matcher/visualize: false
loc/mel_matcher/min_track_length: 1
loc/mel_matcher/max_depth_diff: 15
loc/mel_matcher/max_landmark_depth: 200
loc/mel_matcher/screen_matched_landmarks: false
loc/mel_matcher/parallel_threads: 4
loc/mel_matcher/descriptor_thresh_cpu: 0.11 #on cpu
loc/mel_matcher/descriptor_thresh_gpu: 0.55 #on gpu
loc/mel_matcher/match_on_gpu: false

# RANSAC module
loc/ransac/iterations: 2000
loc/ransac/sigma: 3.0
loc/ransac/threshold: 5.0
loc/ransac/early_stop_min_inliers: 400
loc/ransac/min_inliers: 30
loc/ransac/visualize_ransac_inliers: false
loc/ransac/enable_local_opt: false
loc/ransac/num_threads: 4

# Localization optimisation
loc/steam/iterations: 1
loc/steam/pose_prior_enable: false
loc/steam/verbose: false
loc/steam/use_T_q_m_prior: true
#loc/steam/solver_type: "LevenburgMarquardt"
loc/steam/depth_prior_enable: false
loc/steam/trajectory_smoothing: false
loc/steam/velocity_prior: false
loc/steam/disable_solver: false   # Set true to do everything but run optimise()
loc/steam/allow_increased_loc_uncertainty: true

# Results file (unused)
loc/results/filename: 'results_loc.csv'

# ROS Publishing module
loc/loc_ros_publisher/use_position_as_lla: true
loc/loc_ros_publisher/line_strip_scale: 0.015
