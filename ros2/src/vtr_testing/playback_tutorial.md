# ASRL Playback Tool Tutorial

The asrl__playback package contains the python scripts to launch VTR2 in playback mode: the whole VTR2 system will be brought up to play back a previously recorded dataset pretending it's running live, except that no external hardware (robot, camera, controller) is connected.

The playback tool uses python scripts to launch the main VTR2 build (complied from C++) and only requries the previously recorded graph structure files and image streams. It is mainly used to debug the system or to re-process existing datasets with different versions of the VT&R algorithms.

To use the playback tool, a previously recorded dataset is required. To play back a dataset, please follow these two steps:

## Step 1: Generate plaback configuration file

Given a dataset, the playback tool first needs a configruation file specifying which runs in the dataset are expected to be played back.
This configuration file can be generated by the script residing at `asrl__playback/bin/replay_configure.py`.
An example to run the script from the command line:

```bash
rosrun  asrl__playback replay_configure.py -r ':' -g /path/to/sample_data_folder/ -o 'play_cfg.yaml'
```

The script has a number of configurable input params:

- -r: The run(s) to play (defaults to all), e.g.: `'0', ':', '1:', '2,3' or '1:4,2:9'`
- -g: Path to input graph dir (defaults to './')
- -i: Input graph index file (defaults to 'graph0.index')
- -o: The output filename for the mission (defaults to 'play_cfg.yaml')
- -t: Do not minimally trim the privileged subsegment waypoints
- -v: Use vertex ids instead of timestamps for waypoints
- -s: Print to stdout instead of file
- -f: Overwrite existing playback config without asking
- --seperate: Generate separate configs for each run
- --maskruns: Mask out the runs in the current mission and later

### Step 2: Play back the data

With the dataset and playback configurations generated, the playback tool is ready to play back the data. The python script resides at `asrl__playback/bin/playback.py`
An example to run the script from the command line:

```bash
rosrun asrl__playback playback.py -d /path/to/sample_data_folder/  -g /path/to/output_folder -s playback play_cfg.yaml
```

The script has a number of configurable input params:

- -d: Path to input graph dir (defaults to './')
- -g: Path to output graph dir (defaults to './')
- -i: Input graph index, as in graph\*.index where \* is an int (defaults to 0)
- -o: Output graph index, as in graph\*.index where \* is an int (defaults to be the same as -i)
- -s: The scenario file for vtr2 (defaults to 'playback')
- -l: The launch file for vtr2 (defaults to 'vtr2')
- -b: The robot we are replaying data for: grizzly, lancaster etc. (defaults to "grizzly")
- -r: playback rate multiplier (0 for as fast as possible without dropping, defaults to 1.0)
- -f: fudge timestamps so it appears as though data being played back is happening right now
- -v: verbose
- --ignore-mask: ignore the mask part of the playback configs

Note that the input and output data directory can be the same, but you may want to avoid it most of the time to keep the folders clean.

The playback tool doesn't change anything about the main VT&R algorithm, the main algorithm can be configured through the scenario files located at `asrl__navigation/param/scenarios` (and navigator.xml in asrl__navigation).
